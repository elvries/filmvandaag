/*
** Manually go to https://www.filmvandaag.nl/zoek?q=
** Use https://wtools.io/convert-list-to-json-array to convert text items to json array.
*/

const edv_wishlist = ["Boyhood","Blackhat","What we do in the shadows","Nightcrawler","Exodus: Gods & Kings","PS I Love You","Wild Tales","Lie of Crime","As Above/So Below","The Drop","Jessabelle","Revenge of the Green Dragon","Horns","Stonehearst Asylum","Locke","St Vincent","Nausicaa","The Damned","The Homesman","As Above So Below","Chef","Sin City A Dame To Kill For","A most wanted man","Coherence","Let's be Cops","Wrong Turn 2: Dead End","Blackmail","Borgman","The fault in our stars","The Grand Budapest Hotel","Videodrome","The Two Faces of January","Night Moves","13 Sins","Devils Knot","Blue Ruin","Incendies","De 100-jarige man die uit het raam klom en verdween","Oculus","Reasonable Doubt","That Awkward Moment","Doorbijten","Rood","Lijkzang","The Frighteners","The Keeper of Lost Causes","Snowpiercer","Het Vonnis","Dossier K.","3 days to kill","Open Grave","Lone Survivor","Its the end of the world (met Seth Rogen)","Nebraska","Her","Saving Mr. Banks","The Butler","Out of the furnace","Frankenstein","The Weekend","I, Frankenstein","Devils due","American Hustle","Primer","Paranormal Activity The Marked Ones","Enough Said","Resolution","The Battery","Batman the dark knight returns animation","The Secret Life of Walter Mitty","Kapringen","13 days","bros before ho's","battlestar galactica","The secret in their eyes","Me and you and everone we know","Rushmore","Man on Wire","Nine lives","The Way Way Back","The Counselor","Vijf mannen","Prince Avalanche","Don Jon","Wolf","Twelve Years A Slave","O Brother Where Art Thou","Say Anything","The Cooler","Boogie Nights","This is the End","Jobs","Solaris","Headhunters","Race to Witch Mountain","frances ha","The Sapphires","Byzantium","Hangover 3","21 grams","The company you keep","The haunting in Georgia","All is lost","Flight of the Butterflies","The Grand Master","The Big Wedding","Scary Movie 4","Scary Movie 5","Warm Bodies","A late quartet","Stoker","Valentino","Drag me to hell","Oz the great and powerful","Broken","Promises Land","I give it a year","Texas Chainsaw 3D","Hansel and Gretel Witch Hunters","The Following","jagten","Amour","Beasts of the Southern Wild","The Awakening","Deadfall","Seven Psychopaths","Lawless","Quest for fire","Alex Cross","Running on empty","Ruby Sparks","Hope Springs","Love is all you need","De regels van Mathijs","Dans la Maison","The Domino Effect","Robot & Frank","Alles is familie","Red Lights","For the end of the world seeking a friend","Ruby starr","The Angels Share","Crazy Heart","A Few Best Men","Abraham Lincoln Vampire Hunter","The Raid","Rock of Ages","King of Kong","Somewhere tonight","Moonrise Kingdom","Act of valor","Seeking Justice","The Raven","The Division","Killer Joe","Cronos","The Devils Reject","Silent House","As it is in Heaven","Take Shelter","Princess Mononoke","Grave of the Fireflies","My Neighbour Totoro","Laputa: Castle in the Sky","Spirited Away","Akira","Ghost in the Shell","The Last Samurai","Haywire","The Artist","Plan C","Quiz","A Boys Life","Tyrannosaur","The Descendants","Black Out","Tresspass","Margin Call","The Monsters of Nix","Sugarland Express","Beginners","The Rum Diary","In Time","I don't know how she does it","What's your Number","The Trip","Submarine","De Bende van Oss","The Good, the Bad and the Weird","Midnight in Paris","Your Highness","Essential Killing","Attack the Block","Claustrofobia","The Truth","Thirteen","Hondskop","Out of Sight","Bodyguards and Assassins","Pontypool","Mary and Max","Alle Tijd","Drones","Fase 7","Hell Driver","Rubber","The Troll Hunter","Super","Bitter Feast","Chop","Monsters","Hobo with a shotgun","Rare Exports","Hereafter","Never Let Me Go","Red Faction Origins","The Mechanic","Nick of time","Animal Kingdom","The Kings Speech","Pizzamaffia","Biutiful","Gnomeo & Juliet","Next Door","Tamara Drewe","Morning Glory","Black Swan","Love & Other Drugs","Gullivers Travels","Primal Fear","Alice in Wonderland","The Book of Eli","Collector","The Kids Are Allright","Catfish","Soul Kitchen","Wall Street: Money Never Sleeps","Hereafter","Jacobs Ladder","Vanilla Sky","A Scanner Darkly","The American","Going the Distance","Four Lions","A Somewhat Gentle Man","You Don't Know Jack","Machete","Predators","Sterke Verhalen","Crime d'Amour","The Last Samurai","Exam","Team America","Dinner for the Schmucks","Ondine","De Gelukkige Huisvrouw","Triangle","Leap Year","Lebanon","The Beast of War","The Man from Earth","She's out of my league","Edge of darkness","Shrek 4 forever after","The host, joon-ho bongs","Kom niet aan mijn kinderen","Les barons","1.4 Wonder Woman","1.5 Green Lantern: First Flight","1.6 Superman/Batman: Public Enemies","Justice League: Crisis on Two Earths","Centurion","Fantastic Mr. Fox","Precious","A Single Man","Un Prophete","The Imaginarium of Doctor Parnassus","Solomon Kane","From Paris with Love","An Education","Antichrist","Das Weisse Band","Triangle","A boyfriend for christmas","Where the Wild Things are","Komt een vrouw bij de dokter","Capitalism: a love story","Moon","Yip Man","Antikorper","The Machinist","Revanche","500 days of summer","Y tu mama tambien","Drag me to Hell","Towelhead","De Laatste Dagen van Emma Blank","Departures","Fighting","The Last House on the Left","Rocky Balboa","Night at the Museum 2","Tropa de Elite","The Boat that Rocked","Stranded","Donkey Punch","Rachel Getting Married","Slumdog Millionaire","Transsiberian","Wallace & Gromit in 'A Matter of Loaf and Death'","Oorlogswinter","Milk","Pride and Glory","Anywhere but home","Poultrygeist: Night of the Chicken Dead","Blood Simple","The Hunting Party","Waz","Burn after Reading","Sex Drive","Babylon A.D.","Bug","Midnight Meat Train","Scar 3D","Hoe overleef ik mezelf","Happy-Go-Lucky","Paris","Another Earth","Leatherheads","Before The Devil Knows You're Dead","El Orfanato","A Simple Plan","Dunya en Desie","Dan in Real Life","Street Kings","Rose Red","Desperation","Reservation Road","Sextet","Into the Wild","In the Valley of Elah","TBS","Bond 22","Funny Games","Sweeney Todd","Charlie Wilsons war","Alibi","The Kite Runner","Michael Clayton","Run Fatboy Run","Atonement","The Brave One","Anche Libero Va Bene","Mr. Brooks","Wolfsbergen","Hairspray","The Simpons Movie","Wolf creek","Underworld 2","Raak","Dennis P.","Escort","Kicks","Lonely Hearts","The Last King of Scotland","A Prairie Home Companion","Volver","Running with Scissors","Tenacious D: In the Pick of Destiny","The Passion of the Christ","Beetje verliefd","Nachtrit","Sl8n8","Jay and Silent Bob Strike Back","Fragile","American dreamz","D-Babel","The Libertine","Karakter","Breaking the Waves","Secrets & Lies","The Thin Red Line","The Fisher King","Suzhou River","Shower","Audition","Solas","The Indian Runner","Dancer in the Dark","Pane e Tulipani","Requiem for a Dream","Cidade de Deus","Goodfellas","Leon","The Final Countdown"];
//const edv_wishlist = ["As Above So Below","Chef","Sin City A Dame To Kill For","A most wanted man","Coherence","Let's be Cops","Wrong Turn 2: Dead End","Blackmail","Borgman"];

function search(movie) {
//    console.log(`${movie} :`)
    let searchButton = document.querySelector("#search-sidebar > form > div:nth-child(1) > div.body > label:nth-child(2) > input[type=radio]");
    searchButton.click();
    edv_searchInput = document.querySelector("#search-sidebar > form > div:nth-child(3) > input");
    edv_searchInput.value = movie;
    document.querySelector("#search-sidebar > form > div:nth-child(3) > fieldset > label:nth-child(1) > input[type=radio]").click();
    document.querySelector("#search-sidebar > form > div:nth-child(3) > fieldset > label:nth-child(2) > input[type=radio]").click();
}

function addToWatchList(movie) {
    movies = document.querySelectorAll('#fv-search > div.search.main > div.search-results > ul > li[class="item is-movie"]');
    moviesArray = Array.from(movies);
    results = moviesArray.filter(item => item.outerText.toLowerCase().includes('\n' + movie.toLowerCase() + ' ('));
    
    if (results.length === 0) {
        console.log(`${movie} - not found`);
        return;
    } else if (results.length > 1) {
        console.log(`${movie} - more than 1 movie found`);
        return;
    } else if (!results[0].innerText.toLowerCase().includes(movie.toLowerCase())) {
        console.log(`${movie} - result does not contain movie`);
        return;
    }

    // Only one result remaining, find index
    resultIndex = moviesArray.findIndex(item => item.outerText.toLowerCase().includes('\n' + movie.toLowerCase() + ' ('));
    
    edv_watchlistButton = document.querySelector(`#fv-search > div.search.main > div.search-results > ul > li > div.rating > div > div:nth-child(${2 + resultIndex}) > div`);
    
    if (edv_watchlistButton.classList.contains('active')) {
//        console.log(`${movie} - already in watchlist`);
    } else {
        edv_watchlistButton.click();
//        console.log(`${movie} - added to watchlist`);
    }
}

const timer = ms => new Promise(res => setTimeout(res, ms))

async function load() {
    for (const movie of edv_wishlist) {
        search(movie);
        await timer(2000);
        addToWatchList(movie);
        await timer(5000);
    };
}

// location.href = "https://www.filmvandaag.nl/zoek?q="; // go to search page with filters
load();

// const button = document.querySelector("#filmpagina > div.filmpagina-info.movie > div:nth-child(1) > div.filmpagina-info-cover > div.show-desktop > div.watchlist > div.grid > div:nth-child(2) > button")
// if (button.classList.contains('inwatchlist')) {
//     button.click();
//     console.log(`Added ${movie}`);
// }

